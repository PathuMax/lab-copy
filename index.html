<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>404 NOT FOUND</title>
  <style>
    html,body{height:100%;margin:0;background:#fff}
    #fallback{display:none;position:fixed;inset:0;align-items:center;justify-content:center;font-family:sans-serif}
    #fallback.show{display:flex}
  </style>
</head>
<body>
  <div id="fallback">
    <p>Action blocked. <button id="manual">Retry</button></p>
  </div>

<script>
async function fetchFile(path){
  try{
    const res = await fetch(path, {cache: "no-store"});
    if(!res.ok) throw new Error("Failed to fetch " + path);
    return await res.blob(); // fetch always as blob so we can decide later
  }catch(e){
    console.error(e);
    return null;
  }
}

function isTextFile(filename){
  return /\.(txt|html|css|js|json|py|java|c|cpp|md)$/i.test(filename);
}

async function blobToText(blob){
  return await blob.text();
}

async function copyText(t){
  if(!t) return false;
  if(navigator.clipboard?.writeText){
    try { await navigator.clipboard.writeText(t); return true; } catch{}
  }
  try{
    const ta = document.createElement('textarea');
    ta.value = t;
    ta.style.position='fixed';
    ta.style.left='-9999px';
    document.body.appendChild(ta);
    ta.select();
    const ok = document.execCommand('copy');
    document.body.removeChild(ta);
    return !!ok;
  }catch(e){ return false; }
}

function triggerDownload(blob, filename){
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

async function handleKeyPress(e){
  const key = e.key;
  let file = null;

  if(key === '1') file = 'program.txt';
  else if(key === '3') file = 'sdn 3.pkt';
  else if(key === '4') file = 'sdn 4.pkt';
  else return;

  const blob = await fetchFile(file);
  if(!blob){
    console.warn(`Could not fetch ${file}`);
    document.getElementById('fallback').classList.add('show');
    document.getElementById('manual').onclick = ()=>alert(`Could not load ${file} from server.`);
    return;
  }

  if(isTextFile(file)){
    const text = await blobToText(blob);
    const ok = await copyText(text);
    if(ok) console.log(`${file} copied ‚úÖ`);
    else {
      console.warn(`Copy failed for ${file}`);
      document.getElementById('fallback').classList.add('show');
      document.getElementById('manual').onclick = async ()=>{
        const ok2 = await copyText(text);
        alert(ok2 ? `${file} copied ‚úÖ` : `Copy failed ‚ùå`);
      };
    }
  } else {
    // Non-text file ‚Üí download instead of copy
    triggerDownload(blob, file);
    console.log(`${file} downloaded üíæ`);
  }
}

window.addEventListener('keydown', handleKeyPress);
</script>
</body>
</html>
