<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Copy Lab Program</title>
  <style>html,body{height:100%;margin:0;background:#fff}#fallback{display:none;position:fixed;inset:0;align-items:center;justify-content:center;font-family:sans-serif}#fallback.show{display:flex}</style>
</head>
<body>
  <div id="fallback"><p>Auto-copy blocked. <button id="manual">Click to copy</button></p></div>

<script>
async function fetchProgram(path){
  try{
    const r = await fetch(path, {cache: "no-store"});
    if(!r.ok) throw new Error("fetch failed");
    return await r.text();
  }catch(e){ return null; }
}

async function copyText(t){
  if(!t) return false;
  if(navigator.clipboard && navigator.clipboard.writeText){
    try { await navigator.clipboard.writeText(t); return true; } catch{}
  }
  try{
    const ta = document.createElement('textarea');
    ta.value = t;
    ta.style.position='fixed'; ta.style.left='-9999px';
    document.body.appendChild(ta); ta.focus(); ta.select();
    const ok = document.execCommand('copy');
    document.body.removeChild(ta);
    return !!ok;
  }catch(e){ return false; }
}

(async ()=>{
  // change filename if needed
  const program = await fetchProgram('program.txt');
  if(!program){
    // fallback: show manual UI if fetch failed
    document.getElementById('fallback').classList.add('show');
    document.getElementById('manual').onclick = async ()=>{
      alert('Could not load program.txt from server.');
    };
    return;
  }

  const ok = await copyText(program);
  if(ok) return; // silent success, blank page

  // show manual fallback
  document.getElementById('fallback').classList.add('show');
  document.getElementById('manual').onclick = async ()=>{
    const ok2 = await copyText(program);
    alert(ok2 ? 'Copied ✅' : 'Copy failed ❌');
  };
})();
</script>
</body>
</html>
